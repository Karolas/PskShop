DROP TABLE product_attributes;
DROP TABLE product_images;
DROP TABLE cart_products;
DROP TABLE products;
DROP TABLE products_categories;
DROP TABLE cart;
DROP TABLE order_product;
DROP TABLE orders;
DROP TABLE accounts;

CREATE TABLE ACCOUNTS
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	EMAIL            VARCHAR(254) NOT NULL UNIQUE,
	HASHED_PASSWORD  VARCHAR(256) NOT NULL,
	FIRST_NAME       VARCHAR(35),
	LAST_NAME        VARCHAR(35),
	ADDRESS          VARCHAR(200),
	POSTAL_NR        VARCHAR(20),
	TELEPHONE_NR     VARCHAR(35),
	OPT_LOCK_VERSION INTEGER,
	ROLE             VARCHAR(15)
);

CREATE TABLE CART
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	ACCOUNT_ID        INTEGER,
  FOREIGN KEY (ACCOUNT_ID) REFERENCES accounts(ID)
);

CREATE TABLE ORDERS
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	ACCOUNT_ID       INTEGER,
	STATUS           VARCHAR(25),
	ORDER_CREATED    TIMESTAMP,
	FOREIGN KEY (ACCOUNT_ID) REFERENCES accounts(ID)
);

CREATE TABLE PRODUCTS_CATEGORIES
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME             VARCHAR(256) NOT NULL UNIQUE,
	PARENT_CATEGORY  INTEGER
);

CREATE TABLE PRODUCTS
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME             VARCHAR(256) NOT NULL,
	PRICE            NUMERIC(19, 2) NOT NULL,
	DESCRIPTION      VARCHAR(1024),
	SKU_CODE         VARCHAR(35),
  MAIN_IMAGE_ID    INTEGER,
  CATEGORY         INTEGER,
  OPT_LOCK_VERSION INTEGER,
  FOREIGN KEY (CATEGORY) references products_categories(id)
);

CREATE TABLE CART_PRODUCTS
(
	CART_ID               INTEGER,
	PRODUCT_ID            INTEGER,
	AMOUNT                INTEGER,
	PRIMARY KEY (CART_ID, PRODUCT_ID),
	FOREIGN KEY (CART_ID) REFERENCES CART(ID),
	FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(ID)
);

CREATE TABLE ORDER_PRODUCT
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	ORDER_ID         INTEGER NOT NULL,
	PRODUCT_NAME     VARCHAR(256) NOT NULL,
  AMOUNT           INTEGER NOT NULL,
  PRICE            NUMERIC(19, 2),
  FOREIGN KEY (ORDER_ID) REFERENCES orders(ID)
);

CREATE TABLE PRODUCT_ATTRIBUTES
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	PRODUCT_ID       INTEGER NOT NULL,
	ATTRIBUTE_NAME   VARCHAR(256) NOT NULL,
  ATTRIBUTE_DESCRIPTION   VARCHAR(256) NOT NULL,
  FOREIGN KEY (PRODUCT_ID) REFERENCES products(ID)
);

CREATE TABLE PRODUCT_IMAGES
(
	ID               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	PRODUCT_ID       INTEGER NOT NULL,
  FOREIGN KEY (PRODUCT_ID) REFERENCES products(ID)
);