<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core"
>
<h:head>
    <title>Edit product</title>
</h:head>

<h:body>
    <ui:composition template="/WEB-INF/templates/adminBar.xhtml">
        <ui:define name="content">
            <h:form id="edit-product">
                <p:panelGrid  id="product-detail" columns="1"
                              columnClasses="label,value" styleClass="ui-noborder" style="margin-top: 1em">
                    <f:facet name="header">
                        <h:outputText value="Edit product" rendered="#{not modProductEditFront.newProduct}"/>
                        <h:outputText value="Create product" rendered="#{modProductEditFront.newProduct}"/>
                    </f:facet>
                    <p:outputLabel for="name" value="Name:"/>
                    <p:inputText id="name" value="#{modProductEditFront.selectedProduct.name}"/>
                    <p:message for="name"/>

                    <p:outputLabel for="price" value="Price:"/>
                    <p:inputText id="price" value="#{modProductEditFront.selectedProduct.price}"/>
                    <p:message for="price"/>

                    <p:outputLabel for="amount" value="Amount:"/>
                    <p:inputText id="amount" value="#{modProductEditFront.selectedProduct.amount}"/>
                    <p:message for="amount"/>

                    <p:outputLabel for="description" value="Description:"/>
                    <p:inputText id="description" value="#{modProductEditFront.selectedProduct.description}"/>
                    <p:message for="description"/>
                </p:panelGrid>

                <p:panelGrid id="image-main" columns="1" styleClass="ui-noborder">
                    <p:outputLabel value="Main image: "
                                   rendered="#{modProductEditFront.mainImageLocal ne -1 or modProductEditFront.mainImage ne -1 }"/>
                    <o:graphicImage id="mainImageLocal" value="#{imageUtility.getImageLocal(modProductEditFront.mainImageLocal)}"
                                    lastModified="#{modProductEditFront.lastModified}"
                                    rendered="#{modProductEditFront.mainImageLocal ne -1}"/>
                    <o:graphicImage id="mainImage" value="#{imageUtility.getImage(modProductEditFront.mainImage)}"
                                    lastModified="#{modProductEditFront.lastModified}"
                                    rendered="#{modProductEditFront.mainImage ne -1}"/>
                </p:panelGrid>

                <p:panelGrid id="image-detail-local" columns="1" styleClass="ui-noborder">
                    <p:carousel rendered="#{not empty modProductEditFront.imagesBytes}" value="#{modProductEditFront.imageIds}"
                                var="imageId" headerText="New products images"
                                numVisible="1" style="width:250px" cricular="true">
                        <p:panelGrid columns="1">
                            <o:graphicImage value="#{imageUtility.getImageLocal(imageId)}" lastModified="#{modProductEditFront.lastModified}"/>
                            <p:commandButton action="#{modProductEditFront.makeAsMainImageLocal(imageId)}"
                                             value="Make main image" update=":edit-product:image-main" />
                            <p:commandButton action="#{modProductEditFront.deleteImageLocal(imageId)}"
                                             value="Remove image" update=":edit-product:image-detail-local :edit-product:image-main" />
                        </p:panelGrid>
                    </p:carousel>
                </p:panelGrid>

                <p:panelGrid id="image-detail" columns="1" styleClass="ui-noborder"
                             rendered="#{not modProductEditFront.newProduct}">
                    <p:carousel rendered="#{not empty modProductEditFront.selectedProduct.productImageList}"
                                value="#{modProductEditFront.selectedProduct.productImageList}"
                                var="productImage" headerText="Current products images"
                                numVisible="1" style="width:250px" cricular="true">
                        <p:panelGrid columns="1">
                            <o:graphicImage value="#{imageUtility.getImage(productImage.id)}" lastModified="#{modProductEditFront.lastModified}"/>
                            <p:commandButton action="#{modProductEditFront.markAsMainImage(productImage)}"
                                             value="Make main image" update=":edit-product:image-main"
                                             rendered="#{not modProductEditFront.isMarkedForRemoval(productImage)}"/>
                            <p:commandButton action="#{modProductEditFront.deleteImage(productImage)}"
                                             value="Remove image" update=":edit-product:image-detail"
                                             rendered="#{not modProductEditFront.isMarkedForRemoval(productImage)}"/>
                            <p:commandButton action="#{modProductEditFront.keepImage(productImage)}"
                                             value="Keep image" update=":edit-product:image-detail"
                                             rendered="#{modProductEditFront.isMarkedForRemoval(productImage)}"/>
                        </p:panelGrid>
                    </p:carousel>
                </p:panelGrid>

                <p:panelGrid id="product-attributes" columns="1">
                    <p:dataTable value="#{modProductEditFront.selectedProduct.productAttributeList}" var="attribute"
                                 widgetVar="attrNew" type="ordered">

                        <p:column headerText="Attribute">
                            <p:outputLabel value="#{attribute.attributeName}"/>
                        </p:column>
                        <p:column headerText="Description">
                            <p:outputLabel value="#{attribute.attributeDescription}"/>
                        </p:column>
                        <p:column>
                            <h:commandLink value="Delete"
                                           action="#{modProductEditFront.onRowDelete(attribute)}" />
                        </p:column>
                    </p:dataTable>

                    <p:panelGrid columns="1">
                        <p:outputLabel for="attributeName" value="Attribute name:"/>
                        <p:inputText id="attributeName" value="#{modProductEditFront.attributeName}"/>

                        <p:outputLabel for="attributeDescription" value="Attribute description:"/>
                        <p:inputText id="attributeDescription" value="#{modProductEditFront.attributeDescription}"/>
                    </p:panelGrid>

                    <p:commandButton value="Add new row"
                                     actionListener="#{modProductEditFront.onAddNew()}" update="product-attributes"/>
                </p:panelGrid>

                <p:fileUpload fileUploadListener="#{modProductEditFront.fileUpload}" mode="advanced" auto="true"
                              multiple="false" sizeLimit="10000000" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                              update=":edit-product:image-detail :edit-product:image-detail-local"/>

                <p:commandButton value="Update" action="#{modProductEditFront.updateProduct}"
                                 icon="ui-icon-check" style="margin-top: 1em"
                                 update=":edit-product:product-detail" rendered="#{not modProductEditFront.newProduct}"/>
                <p:commandButton value="Create" action="#{modProductEditFront.createProduct}"
                                 icon="ui-icon-check" style="margin-top: 1em"
                                 update=":edit-product:product-detail" rendered="#{modProductEditFront.newProduct}"/>
                <p:messages globalOnly="true"/>
            </h:form>
        </ui:define>
    </ui:composition>
</h:body>
</html>

